







依赖

```xml
<!--consul-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-consul-discovery</artifactId>
        </dependency>
```



配置

```yaml
spring:
  application:
    name: consul-consumer-order
#consul注册中心配置
  cloud:
    consul:
      host: 172.16.29.94
      port: 8500
      discovery:
        service-name: ${spring.application.name}
        heartbeat:
          enabled: true
        prefer-ip-address: true
```



注解&RestTemplate 不再赘述





## 问题

不知道是consul安装有问题，还是代码有问题

生产者注册到consul注册中心后，services check频繁红叉

消费者通过consul注册中心调用，报错

```java
No instances available for consul-provider-payment
java.lang.IllegalStateException: No instances available for consul-provider-payment
```



但是通过discoveryClient查看服务实例，可以查看到生产者和消费者



弹幕有说：consul部署到虚拟机上，Java项目在本地运行，192.168.x.x这种访问不到